"use strict";(self.webpackChunkweb_components_repo=self.webpackChunkweb_components_repo||[]).push([[895],{"./node_modules/.pnpm/@gaopeng123+utils.object@1.1.11/node_modules/@gaopeng123/utils.object/dist/utils.object.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{assignDeep:()=>assignDeep,assignDeepMergeArray:()=>assignDeepMergeArray,assignDeepNotIncludedArray:()=>assignDeepNotIncludedArray,assignIf:()=>assignIf,assignIfByOrder:()=>assignIfByOrder,clearEmpty:()=>clearEmpty,clone:()=>clone,cloneAllArray:()=>cloneAllArray,cloneAllItems:()=>cloneAllItems,cloneAllObject:()=>cloneAllObject,copyText:()=>copyText,filterObject:()=>filterObject,forEachObject:()=>forEachObject,getStyle:()=>getStyle,isVisibleInViewport:()=>isVisibleInViewport,length:()=>length,levitatingBall:()=>levitatingBall,mapObject:()=>mapObject,mousePosition:()=>mousePosition,observeViewport:()=>observeViewport,parentByExpected:()=>parentByExpected,validatesCssValue:()=>validatesCssValue});var _gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@gaopeng123+utils.types@1.1.10/node_modules/@gaopeng123/utils.types/dist/utils.types.esm.js"),_gaopeng123_utils_function__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@gaopeng123+utils.function@1.1.11/node_modules/@gaopeng123/utils.function/dist/utils.function.esm.js"),clone=function clone(val){return(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(val)||(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(val)?JSON.parse(JSON.stringify(val)):val},cloneAllObject=function cloneAllObject(val){var item,obj={};for(var k in val)item=val[k],(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(item)?obj[k]=cloneAllArray(item):(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(item)?obj[k]=cloneAllItems(item):obj[k]=item;return item},cloneAllArray=function cloneAllArray(val){for(var arr=Array.prototype.slice.call(val),newArr=[],len=arr.length,i=0;i<len;i++){var item=arr[i];(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(item)?newArr.push(cloneAllArray(item)):(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(item)?newArr.push(cloneAllObject(item)):newArr.push(val)}return newArr},cloneAllItems=function cloneAllItems(val){return(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(val)?cloneAllArray(val):(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(val)&&cloneAllObject(val),val},mousePosition=function mousePosition(event){return event?event.pageX||event.pageY?{x:event.pageX,y:event.pageY}:{x:event.clientX+document.body.scrollLeft-document.body.clientLeft,y:event.clientY+document.body.scrollTop-document.body.clientTop}:{x:0,y:0}},getStyle=function getStyle(el,styleName){if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isElement)(el)){if(el.currentStyle)return el.currentStyle[styleName];var computed=getComputedStyle(el,null);return computed[styleName]||(computed.getPropertyValue?computed.getPropertyValue(styleName):"")}return""},parentByExpected=function parentByExpected(dom,expected){return"BODY"===dom.tagName||(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isFunction)(expected)&&expected(dom)?dom:parentByExpected(dom.parentNode||dom.parentElement,expected)},copyText=function copyText(span){return new Promise((function(resolve,reject){var text;if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isString)(span))text=span;else{if(!(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isElement)(span))return void resolve({status:!1,message:"请检查参数"+span});text=span.innerText}if(!(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isUndefined)(text)){var input=document.createElement("textarea");document.body.appendChild(input),input.innerHTML=text,input.setAttribute("code","1"),input.select(),document.execCommand("Copy")&&(console.log("复制成功"),resolve({status:!0,message:"复制成功"}));var list=document.getElementsByTagName("textarea");Array.prototype.slice.call(list).forEach((function(item){item.getAttribute("code")&&document.body.removeChild(item)}))}}))},isVisibleInViewport=function isVisibleInViewport(el,partiallyVisible){void 0===partiallyVisible&&(partiallyVisible=!0);var _el$getBoundingClient=el.getBoundingClientRect(),top=_el$getBoundingClient.top,left=_el$getBoundingClient.left,bottom=_el$getBoundingClient.bottom,right=_el$getBoundingClient.right,_window=window,innerHeight=_window.innerHeight,innerWidth=_window.innerWidth;return partiallyVisible?(top>0&&top<innerHeight||bottom>0&&bottom<innerHeight)&&(left>0&&left<innerWidth||right>0&&right<innerWidth):top>=0&&left>=0&&bottom<=innerHeight&&right<=innerWidth},observeViewport=function observeViewport(observeDomList,observeCallBack,wait,options){var elList=[],list=Array.from(observeDomList),debounceFn=(0,_gaopeng123_utils_function__WEBPACK_IMPORTED_MODULE_1__.debounce)((function(){(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isFunction)(observeCallBack)&&observeCallBack(elList),elList=[]}),wait,options),IO=new IntersectionObserver((function(ioList){ioList.forEach((function(ioEvent){var el=ioEvent.target,intersectionRatio=ioEvent.intersectionRatio;intersectionRatio>0&&intersectionRatio<=1&&elList.push(el)})),debounceFn()}));list.forEach((function(item){IO.observe(item)}))},validatesCssValue=function validatesCssValue(key,value){for(var prefix=["-o-","-ms-","-moz-","-webkit-",""],prefixValue=[],i=0;i<prefix.length;i++)prefixValue.push(prefix[i]+value);for(var eleStyle=document.createElement("div").style,j=0;j<prefixValue.length;j++)eleStyle[key]=prefixValue[j];return eleStyle[key]},levitatingBall=function levitatingBall(config,onClick){var _Object$assign=Object.assign({minTop:0,minBottom:0,minLeft:0,minRight:0},config),el=_Object$assign.el,up_down=_Object$assign.up_down,left_right=_Object$assign.left_right,style=_Object$assign.style,minTop=_Object$assign.minTop,minBottom=_Object$assign.minBottom,minLeft=_Object$assign.minLeft,minRight=_Object$assign.minRight,persistenceKey=_Object$assign.persistenceKey,persistenceType=_Object$assign.persistenceType;if(el){var startEvt,moveEvt,endEvt,_persistenceType=persistenceType||"sessionStorage";"ontouchstart"in window?(startEvt="touchstart",moveEvt="touchmove",endEvt="touchend"):(startEvt="mousedown",moveEvt="mousemove",endEvt="mouseup");var dragEl=(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isString)(el)?document.querySelector(el):el;if(dragEl.style.position="fixed",dragEl.style.cursor="move",dragEl.style.transition="all 0.08s",dragEl.style["user-select"]="none",style)for(var styleKey in style)dragEl.style[styleKey]=style[styleKey];if(persistenceKey){var cacheConfig=window[_persistenceType].getItem(persistenceKey);if(cacheConfig&&(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isJSON)(cacheConfig)){var _JSON$parse=JSON.parse(cacheConfig),_left=_JSON$parse.left,_top=_JSON$parse.top;dragEl.style.top=_top+"px",dragEl.style.left=_left+"px"}}var disX,disY,left,top,starX,starY,isClick=!0,moveFun=(0,_gaopeng123_utils_function__WEBPACK_IMPORTED_MODULE_1__.debounce)((function(){persistenceKey&&window[_persistenceType].setItem(persistenceKey,JSON.stringify({left,top}))}),200,{notDebounce:function moving(event){var e=event||window.event;(Math.abs(starX-(e.touches?e.touches[0].clientX:e.clientX))>20||Math.abs(starY-(e.touches?e.touches[0].clientY:e.clientY))>20)&&(isClick=!1),left=(e.touches?e.touches[0].clientX:e.clientX)-disX,top=(e.touches?e.touches[0].clientY:e.clientY)-disY,left<minLeft?left=minLeft:left>document.documentElement.clientWidth-dragEl.offsetWidth-minRight&&(left=document.documentElement.clientWidth-dragEl.offsetWidth-minRight),top<minTop?top=minTop:top>document.documentElement.clientHeight-dragEl.offsetHeight-minBottom&&(top=document.documentElement.clientHeight-dragEl.offsetHeight-minBottom),!1!==up_down&&(dragEl.style.top=top+"px"),!1!==left_right&&(dragEl.style.left=left+"px")}});dragEl.addEventListener(startEvt,(function(event){event.preventDefault();var e=event||window.event;isClick=!0,starX=e.touches?e.touches[0].clientX:e.clientX,starY=e.touches?e.touches[0].clientY:e.clientY,disX=starX-dragEl.offsetLeft,disY=starY-dragEl.offsetTop,document.addEventListener(moveEvt,moveFun),document.addEventListener(endEvt,endFun)}));var endFun=function endFun(e){document.removeEventListener(moveEvt,moveFun),document.removeEventListener(endEvt,endFun),isClick&&(null==onClick||onClick(e))};return{removeEventListener:function removeEventListener(){document.removeEventListener(moveEvt,moveFun),document.removeEventListener(endEvt,endFun)}}}return{removeEventListener:function removeEventListener(){}}},mergeArray=function mergeArray(input){return input.map(mergeValue)},mergeObject=function mergeObject(source){var output={};for(var key in source)source.hasOwnProperty(key)&&(output[key]=mergeValue(source[key]));return output},mergeValue=function mergeValue(value){return(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(value)?mergeObject(value):(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(value)?mergeArray(value):value},deepMerge=function deepMerge(target,sources,options){for(var _options={arrayHandle:(null==options?void 0:options.arrayHandle)||"replace"},output=target||{},oIndex=0;oIndex<sources.length;oIndex++)for(var source=sources[oIndex],keys=Object.keys(source),kIndex=0;kIndex<keys.length;kIndex++){var key=keys[kIndex],sourceValue=source[key],targetValue=output[key];if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(sourceValue))if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isUndefined)(targetValue))output[key]=mergeValue(sourceValue);else{var existingValue=(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(targetValue)?targetValue:{};output[key]=deepMerge({},[existingValue,mergeValue(sourceValue)],_options)}else if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(sourceValue))if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(targetValue))if("cover"===_options.arrayHandle)output[key]=targetValue;else{var newValue=mergeArray(sourceValue);output[key]="merge"===_options.arrayHandle?output[key].concat(newValue):newValue}else output[key]=mergeArray(sourceValue);else output[key]=sourceValue}return output},assignDeep=function assignDeep(target){for(var _len=arguments.length,source=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)source[_key-1]=arguments[_key];return deepMerge(target,source)},assignDeepNotIncludedArray=function assignDeepNotIncludedArray(target){for(var _len2=arguments.length,source=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)source[_key2-1]=arguments[_key2];return deepMerge(target,source,{arrayHandle:"cover"})},assignDeepMergeArray=function assignDeepMergeArray(target){for(var _len3=arguments.length,source=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)source[_key3-1]=arguments[_key3];return deepMerge(target,source,{arrayHandle:"merge"})},assignIfByOrder=function assignIfByOrder(order,target){for(var _target=Object.assign({},target),_len4=arguments.length,source=new Array(_len4>2?_len4-2:0),_key4=2;_key4<_len4;_key4++)source[_key4-2]=arguments[_key4];return null==source||source.forEach((function(sourceItem){var property;if((0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(target)&&(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(sourceItem))for(property in sourceItem)order(_target[property])&&(_target[property]=sourceItem[property])})),_target},assignIf=function assignIf(target){for(var _len5=arguments.length,source=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++)source[_key5-1]=arguments[_key5];return assignIfByOrder.apply(void 0,[function(v){return(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isNull)(v)||(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isUndefined)(v)},target].concat(source))},filterObject=function filterObject(obj,callback){var index=0,newObj=Object.assign({},obj);for(var key in newObj){if(callback)!1===callback(newObj[key],index,obj)&&delete newObj[key];index++}return newObj},forEachObject=function forEachObject(obj,callback){var index=0,newObj=Object.assign({},obj);for(var key in newObj){if(callback){var callBackVal=callback(newObj[key],index,obj);newObj[key]=callBackVal}index++}return newObj},mapObject=function mapObject(obj,callback){var index=0;for(var key in obj){if(callback){var callBackVal=callback(obj[key],index,obj);obj[key]=callBackVal}index++}return obj},length=function length(val){return(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isObject)(val)?Object.keys(val).length:(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isArray)(val)||(0,_gaopeng123_utils_types__WEBPACK_IMPORTED_MODULE_0__.isString)(val)?val.length:0};function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}var clearEmpty=function clearEmpty(origin){return Object.keys(origin).reduce((function(res,key){var _extends2;return[null,void 0,""].includes(origin[key])?res:_extends({},res,((_extends2={})[key]=origin[key],_extends2))}),{})}},"./stories/VideoProgressBar.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,default:()=>VideoProgressBar_stories,props:()=>props});var utils_esm=__webpack_require__("./node_modules/.pnpm/@gaopeng123+utils@1.1.8/node_modules/@gaopeng123/utils/dist/utils.esm.js");const BG="#000000",BD="#333333",addEventFactory=(dom,type,fn,useCapture=!1)=>{dom&&dom.addEventListener(type,fn,useCapture)},removeEventFactory=(dom,type,fn,useCapture=!1)=>{dom&&dom.removeEventListener(type,fn,useCapture)},SCALE_LEVEL={0:{n:"24h",v:864e5},1:{n:"12h",v:432e5},2:{n:"6h",v:216e5},3:{n:"1h",v:36e5},4:{n:"36m",v:216e4},5:{n:"24m",v:144e4},6:{n:"12m",v:72e4}},DEFAULT_CURRENT_TIME=(0,utils_esm.getTime)(`${(0,utils_esm.formatTimestamp)(Date.now(),"yyyy-MM-dd")} 00:00:00`);class VideoProgressBar extends HTMLElement{shadow=null;config={};constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=(this.config,`\n        <style>\n             /*时间拖动区域*/\n            .timeline {\n                position: relative;\n                height: 60px;\n                line-height: 60px;\n                text-align: center;\n                background-color: #000000;\n                overflow: hidden;\n             }\n             /*拖拽样式*/\n            .timeline-drag {\n                position: absolute;\n                width: 100%;\n                height: 100%;\n            }\n           \n             .timeline-datetime-level {\n                position: absolute;\n                font-size: 12px;\n                bottom: 24px;\n                right: 0px;\n                height: 12px;\n                line-height: 12px;\n                border: 1px solid ${BD};\n                background-color: ${BG};\n                border-radius: 2px;\n                display: flex;\n                color: #ffffff;\n             }\n\n             .tbar {\n                 cursor: pointer;\n             }\n             .tbar:hover {\n                background-color: #a59999;\n             }\n\n             .disabled {\n                cursor: not-allowed;\n                background-color: #726c6c;\n             }\n\n             #levelValue {\n                width: 28px;\n                padding: 0px;\n             }\n\n            .disabled-input {\n                 height: 16px;\n                 width: 150px;\n                 top: 44px;\n                 position: absolute;\n                 left: calc(50% - 86px);\n            }\n            \n            .active {\n                text-align: center;\n                height: 60px;\n                -webkit-user-select: none; /* Safari */\n                user-select: none;\n            }\n        </style>\n       <div id="timeline" class="timeline">\n        <div class="timeline-drag">\n            <canvas id="timeline-drag-canvas"></canvas>\n        </div>\n        <div class="active">\n            <video-progress-bar-active-time></video-progress-bar-active-time>\n        </div>\n        \n        <div class="timeline-datetime-level">\n            <img id="del" class="tbar" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABVUlEQVQ4T6WTv0vWURSHn+cfKINMCoKmElzcWgUnx8BIGuxtylmUnNS20IqGpiZbmnRu6YcEDf4PipDIizpotrSdOHpvvL4m7ze6cLnD+dyHz7nnc+U/l533I+I6MAxcAi4DV4DUHAHHZR+oG/XeH0BELAILwIci/AEcFmGC+gr0LvBafZa1E0BEZPFQPePob90Vl6vAuNqugHHggXq/yZNExFNgU12rgBlgQJ1tCEh9qC8r4AWwry41BKSDfnWmAlaAdTXPfJPHwO0u2Lb6ttRbwIjaqoB3wJcOwBRwpwuwpb4pgAlgTH1UAa+AtrrcsIXJzIs6XQFzwNXsqSHgSYZMfV4BD4F7/zjGHfV9BWR8PwNDGY5eLiLiGzCvfuqMcsZ4FPieIwX2yk7eAHAt2wRuAl/VjP5plOuKiFvAYMn8jTLK1GwCu8BP4Jf68dxn6mX7ovpvr1CGEYQMEQkAAAAASUVORK5CYII=" />\n            <div id="levelValue">24h</div>\n            <img id="add" class="tbar" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABRUlEQVQ4T6WTvyvGURSHn6cMWFAGbCZZZFEMdiRlEpNSb2IyMbLpnWTwY38zK2VgsBODUkxvMsjkxz9wdXWvXl/0TW6d5d7Pfe45n3uO/HPZeD+EMAh0Ae0NESUvwFuKR/Uy3/sEhBDWgUXgKglfgWcgAG0pIngC2FCjng9ACKEbeFCbyipK2jrQqz5mwDhQUafLAOnBNeBaPc6AGWBYXSl4UoleqNXC/lL0RT3IgChsVbcKwg2gU10u7M8m8G4GrAJ36mFKcR7oA0aBFuAEuFf30vkYMKhuZkCs6bYBEDPqB0aAZuAMqKvbvwHi9zX/sYQOdSdnMAcM/WBiNDeauP+DiW9qLQMmgYU/fuONepQBQ0BNjcaVrhBCDaiq18VWHgDOUyvHNm5s5Y40H1PA6ZdWzk+GECKgp2SYntSLb8NUmvcvgndf85gRc9c+xwAAAABJRU5ErkJggg==" />\n        </div>\n       </div>\n    `),this.init()}init(){}get _canvas(){return this.shadow.querySelector("#timeline-drag-canvas")}get _context(){return this._canvas.getContext("2d")}get datetime(){return this.shadow.querySelector("video-progress-bar-active-time")}_wheelDelta=0;get wheelDelta(){return this._wheelDelta}set wheelDelta(v){const previousWheelDelta=this.wheelDelta,wheelDelta=this._wheelDelta+v;wheelDelta>=0&&wheelDelta<Object.keys(this.__scaleLevel).length&&(this._wheelDelta+=v),previousWheelDelta!==this.wheelDelta&&(this.__dragCurrentX=this.diffZoomLevelValue,this.zoomStart(),this.setLevelValue(),this.__dragX+=this.__dragCurrentX),this.__dragCurrentX=0}zoomStart(){this.draw()}dragStart(status){this.draw(),this.setCurrentTime()}__dragStartEvent=null;__dragCurrentX=0;__dragX=0;_onmousewheel=(0,utils_esm.debounce)((e=>{this.wheelDelta=e.wheelDelta>0?1:-1}),200,{notDebounce:e=>{e.preventDefault(),e.stopPropagation()}});layerX=null;_onmousedown(e){this.__dragStartEvent=e,e&&this.stop()}_onmouseup(e){this.__dragStartEvent&&this.setDateTime({status:"loading"}),e&&this.__dragStartEvent&&this.start(),this.__dragStartEvent=null,this.__dragX+=this.__dragCurrentX,this.__dragCurrentX=null,this.endTime=this.currentTime,this.datetime.canClick()}_onmousemove(e){if(this.__dragStartEvent){const beginX=this.__dragStartEvent.offsetX,endX=e.offsetX;this.__dragCurrentX=endX-beginX,this.dragStart(null),this.datetime.canNotClick()}}onAddClick=(0,utils_esm.debounce)((()=>{this.wheelDelta=1}),50);onDelClick=(0,utils_esm.debounce)((()=>{this.wheelDelta=-1}),50);addEvent(){addEventFactory(this._canvas,"mousewheel",this._onmousewheel.bind(this)),addEventFactory(this._canvas,"mousedown",this._onmousedown.bind(this)),addEventFactory(this._canvas,"mousemove",this._onmousemove.bind(this)),addEventFactory(this._canvas,"mouseout",this._onmouseup.bind(this)),addEventFactory(this._canvas,"mouseup",this._onmouseup.bind(this)),addEventFactory(this.shadow.querySelector("#add"),"click",this.onAddClick.bind(this)),addEventFactory(this.shadow.querySelector("#del"),"click",this.onDelClick.bind(this)),addEventFactory(this.datetime,"change",this.onchange.bind(this)),addEventFactory(window,"resize",this.onResizeSubscribe.bind(this))}removeEvent(){removeEventFactory(this._canvas,"mousewheel",this._onmousewheel),removeEventFactory(this._canvas,"mousedown",this._onmousedown),removeEventFactory(this._canvas,"mousemove",this._onmousemove),removeEventFactory(this._canvas,"mouseout",this._onmouseup),removeEventFactory(this._canvas,"mouseup",this._onmouseup),removeEventFactory(this.shadow.querySelector("#add"),"click",this.onAddClick),removeEventFactory(this.shadow.querySelector("#del"),"click",this.onDelClick),removeEventFactory(this.datetime,"change",this.onchange.bind(this)),removeEventFactory(window,"resize",this.onResizeSubscribe.bind(this))}afterConnectedFn(){this.setCanvasStyle(),this.startTime=this.defaultCurrentTime,this.initialize({status:"loading"}),this.setLevelValue(),this.draw()}connectedCallback(){this.addEvent(),this.afterConnectedCallback()}afterConnectedCallback(){this.afterConnectedFn(),setTimeout((()=>{this.sendToOutside({status:"loading"})}))}disconnectedCallback(){this.stop()}get timeline(){return this.shadow.querySelector("#timeline")}get timelineWidth(){return this.timeline.offsetWidth}setCanvasStyle(){this._canvas.style.width=`${this.timelineWidth}px`,this._canvas.style.height="60px",this._canvas.width=this.timelineWidth,this._canvas.height=60}__scaleLevel=SCALE_LEVEL;_setTBarClass(tbar,level){this.scaleLevelN===level?(tbar.classList.add("disabled"),tbar.classList.remove("tbar")):tbar.classList.contains("tbar")||(tbar.classList.add("tbar"),tbar.classList.remove("disabled"))}setLevelValue(){const add=this.shadow.querySelector("#add"),del=this.shadow.querySelector("#del"),levelValue=this.shadow.querySelector("#levelValue");this._setTBarClass(add,"12m"),this._setTBarClass(del,"24h"),levelValue.innerText=this.scaleLevelN}get scaleLevelV(){return this.scaleLevel.v}get scaleLevelN(){return this.scaleLevel.n}get scaleLevel(){return this.__scaleLevel[this.wheelDelta]}get diffZoomLevelValue(){return this.timelineWidth*(this.startTime-this.currentTime)/this.scaleLevelV-this.__dragX}get scaleData(){const median=this.scale/2,itemScale=this.scaleLevelV/this.scale,itemWidth=this.timelineWidth/this.scale,dragX=this.__dragCurrentX+this.__dragX;return new Array(this.scale+1).fill("00:00").map(((item,index)=>({time:`${(0,utils_esm.formatTimestamp)(this.startTime+(index-median-parseInt(""+dragX/itemWidth))*itemScale,"HH:mm")}`,x:index*itemWidth+(dragX||0)%itemWidth})))}__startTime=null;get startTime(){return this.__startTime}set startTime(v){this.__startTime=v}__endTime=null;get endTime(){return this.__endTime}set endTime(v){this.__endTime=v}defaultCurrentTime=DEFAULT_CURRENT_TIME;protectCurrentTime=()=>this.currentTime||this.defaultCurrentTime;__currentTime=null;get currentTime(){return this.__currentTime}set currentTime(v){this.__currentTime=v}setCurrentTime(){this.currentTime=(this.endTime||this.startTime)-parseInt(""+this.__dragCurrentX/this.timelineWidth*this.scaleLevelV)}publishTimeline(obj){this.dispatchEvent(new CustomEvent("timeChange",{detail:obj}))}sendToOutside(e,value){if("loading"===e?.status){const currentTime=this.protectCurrentTime();this.publishTimeline(Object.assign({action:"drag",isInPeriods:this.checkCurrentTimeInPeriods(currentTime),timestamp:currentTime,date:(0,utils_esm.formatTimestamp)(currentTime),"speed-value":this.datetime.speed},value))}}drawData=data=>{this.initVideoOptions({periods:data.periods||[],currentTime:(0,utils_esm.getTime)(data.currentTime||DEFAULT_CURRENT_TIME)}),this.draw(),this.start()};changeSpeed=data=>{this.__intervalSpeed=data["speed-value"]?Number(data["speed-value"]):this.__intervalSpeed,this.start()};fastForward=data=>{const forwardValue=data["forward-value"]?Number(data["forward-value"]):0;forwardValue&&(this.__periodsTime=forwardValue,this.start())};initVideoOptions(data){this.__periods=data?.periods,this.defaultCurrentTime=(0,utils_esm.getTime)(data.currentTime);const status=data?.currentTime!==this.startTime?{status:"reset"}:null;this.startTime=data.currentTime,this.initialize(status)}timeCalibration=()=>{this.__dragCurrentX=-1e3*this.timelineWidth/this.scaleLevelV+(this.__dragCurrentX||0)};onResizeSubscribe=(0,utils_esm.debounce)((()=>{this.__dragX=this.timelineWidth/this._canvas.offsetWidth*this.__dragX,this.setCanvasStyle(),this.draw()}));onSplitScreenChangeSubscribe({data:{type,value,videoOptions}}){this.reset(),this.startTime=this.defaultCurrentTime,this.initialize(null),value&&(this.reset(),this.startTime=value?.currentPlayTime(),this.initVideoOptions(videoOptions),this.draw(),this.start())}setTime(time){this.datetime.setAttribute("time-value",(0,utils_esm.formatTimestamp)(time))}initialize(e){this.startTime&&(this.currentTime="reset"===e?.status?this.startTime:this.currentTime||this.startTime,this.setTime(this.currentTime),"reset"===e?.status&&(e.status="loading"))}loadingState=e=>{"loading"===e?.status&&(this.stop(),this.publish("loading",{type:!0}),setTimeout((()=>{this.publish("loading",{type:!1})}),5e3))};setDateTimeFn=(e,value)=>{this.sendToOutside(e,value),this.loadingState(e)};setDateTime=(0,utils_esm.debounce)((e=>{this.setDateTimeFn(e)}),200,{notDebounce:e=>{this.initialize(e)}});resetSubscribe({data:{type}}){"timeline"===type&&this.reset()}reset(){this.stop(),this.__dragStartEvent=null,this.__dragCurrentX=0,this.__dragX=0,this._wheelDelta=0,this.currentTime=null,this.startTime=null,this.endTime=null,this.__periods=null,this.setDateTime({status:"reset"}),this.setLevelValue()}changeEvent=e=>{this.checkDatetime()&&(this.__dragCurrentX=(this.currentTime-new Date(this.datetime.value).getTime())*this.timelineWidth/this.scaleLevelV,this.dragStart(null),this.initialize({status:"loading"}),this.setDateTimeFn({status:"loading"},e.detail))};onchange=(0,utils_esm.debounce)((e=>{this.changeEvent(e),this.stop()}));publish=(type,opts)=>{};checkDatetime=()=>this.datetime.value;timelineSubscribe({data:{type,value}}){if("needle"===type)switch(value){case"start":this.start();break;case"stop":this.stop();break;case"restart":this.sendToOutside({status:"loading"});break;default:console.log(`needle的type: ${value}`)}}__pollingTimer=null;stop=()=>{this.clearPollingTime()};clearPollingTime(){clearInterval(this.__pollingTimer)}checkPeriods(){if(this.__periods?.length){const currentTime=new Date(this.currentTime).getTime();for(let i=0;i<this.__periods?.length;i++){const{__start,__end}=this.__periods[i],__last=this.__periods[i+1];if(__last&&currentTime>__end&&currentTime<=__last.__start){this.__periodsTime=(__last.__start-__end)/1e3;break}}}}checkCurrentTimeInPeriods(time){if(this.__periods?.length)for(let i=0;i<this.__periods?.length;i++){const{__start,__end}=this.__periods[i];if(time>=__start&&time<=__end)return!0}return!1}__periodsTime=1;__intervalSpeed=1;pollingTimeRun(){this.__pollingTimer=setInterval((()=>{this._onmousedown(null),this.checkPeriods(),this.__dragCurrentX=-1e3*this.__periodsTime*this.timelineWidth/this.scaleLevelV+(this.__dragCurrentX||0),this.__periodsTime=1,this.dragStart(null),this.setDateTime({status:"polling"}),this._onmouseup(null)}),1e3/this.__intervalSpeed)}start(){this.clearPollingTime(),this.pollingTimeRun()}draw(){this.clearCanvas(),this.drawScale(),this.drawDispatch(),this.drawSchedule()}clearCanvas(){this._context.clearRect(0,0,this.timelineWidth,60)}drawLine(x,y,x1,y1,sl,lw=1){this._context.save(),this._context.beginPath(),this._context.moveTo(x,y),this._context.lineTo(x1,y1),this._context.strokeStyle=sl,this._context.lineWidth=lw,this._context.stroke(),this._context.closePath(),this._context.restore()}drawText(text,x,y,fl,ft=12,mw=20){this._context.save(),this._context.textAlign="center",this._context.font=`${ft}px Arial`,this._context.fillStyle=fl,this._context.fillText(text,x,y,24),this._context.restore()}scale=12;drawScale(){this.drawLine(0,0,this.timelineWidth,0,"#f7ff2f"),this.scaleData.forEach((({time,x},index)=>{this.drawLine(x,0,x,9,"#fffdd9"),this.drawText(time,x,21,"#ffffff")}))}drawDispatch(){const w=this.timelineWidth/2;this.drawLine(w,2,w,this._canvas.offsetHeight,"#2bff3c",2),this.drawLine(w,2,w+4,8,"#2bff3c",2),this.drawLine(w,2,w-4,8,"#2bff3c",2)}drawSchedule(){null!==this.__periods&&this.scheduleData?.forEach((item=>{this.drawSingleSchedule(item)}))}drawSingleSchedule({w,x}){this._context.save(),this._context.fillStyle="rgba(174,218,255,.7)",this._context.fillRect(x,22,w,15),this._context.restore()}__periods=null;get scheduleData(){const __periods=[];return this.__periods?.forEach((item=>{const _startTime=(0,utils_esm.getTime)(item.startTime),_endTime=(0,utils_esm.getTime)(item.endTime);__periods.push(Object.assign({_startTime,_endTime},this.getSingleScheduleData(_startTime,_endTime),item))})),__periods}getSingleScheduleData=(startTime,endTime)=>{const millisecondDistance=this.timelineWidth/this.scaleLevelV;return{w:(endTime-startTime)*millisecondDistance,x:this.timelineWidth/2-(this.currentTime-startTime)*millisecondDistance}}}customElements.get("video-progress-bar")||customElements.define("video-progress-bar",VideoProgressBar);class ForwardSelect extends HTMLElement{shadow=null;__config={options:[]};constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=this.createTemplate()}onChange=e=>{this.dispatchEvent(new CustomEvent("onChange",{detail:{value:e.target.value}}))};connectedCallback(){this.select.addEventListener("change",this.onChange)}disconnectedCallback(){this.select.removeEventListener("change",this.onChange)}static get observedAttributes(){return["options","default-value"]}attributeChangedCallback(name,oldValue,newValue){oldValue!==newValue&&(this.__config[name]=JSON.parse(newValue)),this.renderOption()}get select(){return this.shadow.querySelector(".dropdown-select")}renderOption(){this.select.innerHTML=this.getOption()}getOption(){const options=this.__config.options,defaultValue=this.__config["default-value"];return options.map((item=>`<option ${item.value==defaultValue?"selected":""} value="${item.value}">${item.label}</option>`)).join("")}createTemplate(){return`\n            <style>\n                .dropdown {\n                    display: inline-block;\n                    position: relative;\n                    overflow: hidden;\n                    height: 20px;\n                    width: 60px;\n                    background: #f2f2f2;\n                    border: 1px solid;\n                    border-color: white #f7f7f7 whitesmoke;\n                    border-radius: 3px;\n                    background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.06));\n                    background-image: -moz-linear-gradient(top, transparent, rgba(0, 0, 0, 0.06));\n                    background-image: -o-linear-gradient(top, transparent, rgba(0, 0, 0, 0.06));\n                    background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.06));\n                    -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.08);\n                    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.08);\n                    -webkit-user-select: none; /* Safari */\n                    user-select: none;\n                }\n                \n                .dropdown:before, .dropdown:after {\n                    content: '';\n                    position: absolute;\n                    z-index: 2;\n                    top: 4px;\n                    right: 10px;\n                    width: 0;\n                    height: 0;\n                    border: 4px dashed;\n                    border-color: #888888 transparent;\n                    pointer-events: none;\n                }\n                \n                .dropdown:before {\n                    border-bottom-style: solid;\n                    border-top: none;\n                }\n                \n                .dropdown:after {\n                    margin-top: 7px;\n                    border-top-style: solid;\n                    border-bottom: none;\n                }\n                \n                .dropdown-select {\n                    position: relative;\n                    width: 100%;\n                    margin: 0;\n                    padding: 0px 4px 0px 4px;\n                    height: 20px;\n                    line-height: 14px;\n                    font-size: 12px;\n                    color: #ffffff;\n                    text-shadow: 0 1px white;\n                    background: #333333; /* Fallback for IE 8 */\n                    background: #333333 !important; /* "transparent" doesn't work with Opera */\n                    border: 0;\n                    border-radius: 0;\n                    -webkit-appearance: none;\n                    top: -22px;\n                }\n                \n                .dropdown-select:focus {\n                    z-index: 3;\n                    width: 100%;\n                    color: #394349;\n                    outline: 2px solid #49aff2;\n                    outline: 2px solid -webkit-focus-ring-color;\n                    outline-offset: -2px;\n                }\n                \n                .dropdown-select > option {\n                    margin: 3px;\n                    padding: 6px 8px;\n                    text-shadow: none;\n                    background: #f2f2f2;\n                    border-radius: 3px;\n                    cursor: pointer;\n                }\n                \n                /* Fix for IE 8 putting the arrows behind the select element. */\n                \n                .lt-ie9 .dropdown {\n                    z-index: 1;\n                }\n                \n                .lt-ie9 .dropdown-select {\n                    z-index: -1;\n                }\n                \n                .lt-ie9 .dropdown-select:focus {\n                    z-index: 3;\n                }\n                \n                /* Dirty fix for Firefox adding padding where it shouldn't. */\n                \n                @-moz-document url-prefix() {\n                    .dropdown-select {\n                        padding-left: 6px;\n                    }\n                }\n                \n                .dropdown-dark {\n                    background: #444;\n                    border-color: #111111 #0a0a0a black;\n                    background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));\n                    background-image: -moz-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));\n                    background-image: -o-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));\n                    background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.4));\n                    -webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.1), 0 1px 1px rgba(0, 0, 0, 0.2);\n                    box-shadow: inset 0 1px rgba(255, 255, 255, 0.1), 0 1px 1px rgba(0, 0, 0, 0.2);\n                }\n                \n                .dropdown-dark:before {\n                    border-bottom-color: #aaa;\n                }\n                \n                .dropdown-dark:after {\n                    border-top-color: #aaa;\n                }\n                \n                .dropdown-dark .dropdown-select {\n                    color: #aaa;\n                    text-shadow: 0 1px black;\n                    background: #444;  /* Fallback for IE 8 */\n                    -webkit-user-select: none;\n                    user-select: none;\n                }\n                \n                .dropdown-dark .dropdown-select:focus {\n                    color: #ccc;\n                }\n                \n                .dropdown-dark .dropdown-select > option {\n                    background: #444;\n                    text-shadow: 0 1px rgba(0, 0, 0, 0.4);\n                }\n            </style>\n            <div class="dropdown dropdown-dark">\n            <select name="two" class="dropdown-select">\n              ${this.getOption()}\n            </select>\n          </div>\n        `}}customElements.get("video-progress-bar-forward-select")||customElements.define("video-progress-bar-forward-select",ForwardSelect);const forward_namespaceObject=__webpack_require__.p+"static/media/forward.582bfcd7.svg",backward_namespaceObject=__webpack_require__.p+"static/media/backward.01bf8874.svg";var esm=__webpack_require__("./node_modules/.pnpm/flatpickr@4.6.13/node_modules/flatpickr/dist/esm/index.js"),zh=(__webpack_require__("./node_modules/.pnpm/flatpickr@4.6.13/node_modules/flatpickr/dist/flatpickr.css"),__webpack_require__("./node_modules/.pnpm/flatpickr@4.6.13/node_modules/flatpickr/dist/l10n/zh.js"));const forwardOptions=[{label:"30s",value:"30"},{label:"1分钟",value:"60"},{label:"5分钟",value:"300"}],speedOptions=[{label:"1/4x",value:"0.25"},{label:"1/2x",value:"0.5"},{label:"正常",value:"1"},{label:"2x",value:"2"},{label:"4x",value:"4"}];class ActiveTime extends HTMLElement{shadow=null;__config={"time-value":"","forward-value":"60","speed-value":"1"};__oldConfig={"time-value":"","forward-value":"60","speed-value":"1"};constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=this.createTemplate()}onChange(currentType,value){this.dispatchEvent(new CustomEvent("change",{detail:{currentType,...this.__config,...value||{}}}))}connectedCallback(){this.initFlatpickr(),this.shadow.querySelector("#speed").addEventListener("onChange",this.onSpeedChange),this.shadow.querySelector("#forward").addEventListener("onChange",this.onForwardChange),this.shadow.querySelector("#bth-backward").addEventListener("click",this.onBackwardClick),this.shadow.querySelector("#bth-forward").addEventListener("click",this.onForwardClick)}disconnectedCallback(){this.shadow.querySelector("#speed").removeEventListener("onChange",this.onSpeedChange),this.shadow.querySelector("#forward").removeEventListener("onChange",this.onForwardChange),this.shadow.querySelector("#bth-backward").removeEventListener("click",this.onBackwardClick),this.shadow.querySelector("#bth-forward").removeEventListener("click",this.onForwardClick)}static get observedAttributes(){return["time-value","forward-value","speed-value"]}attributeChangedCallback(name,oldValue,newValue){oldValue!==newValue&&(this.__config[name]=newValue),this.setAllValue()}get value(){return this.__config["time-value"]}get speed(){return Number(this.__config["speed-value"])}set value(v){this.__config["time-value"]=v,this.setTimeValue()}setTimeValue(){const val=this.__config["time-value"];this.datetime.value=val,this.setFlatpickrVal(val)}setAllValue(){this.setTimeValue()}get datetime(){return this.shadow.querySelector("#datetime")}get time(){return this.shadow.querySelector(".time")}onSpeedChange=e=>{this.__config["speed-value"]=Number(e.detail.value),this.onChange("speed-value")};onForwardChange=e=>{this.__config["forward-value"]=Number(e.detail.value)};onBackwardClick=()=>{this.onChange("forward-value",{forwardValue:1e3*-Number(this.__config["forward-value"])})};onForwardClick=()=>{this.onChange("forward-value",{forwardValue:1e3*Number(this.__config["forward-value"])})};canNotClick=()=>{this.time.classList.add("disabled")};canClick=()=>{this.time.classList.remove("disabled")};__flatpickr=null;initFlatpickr(){this.__flatpickr=(0,esm.default)(this.datetime,{dateFormat:"Y-m-d H:i:S",locale:zh.Mandarin,time_24hr:!0,onClose:v=>{const dataStr=(0,utils_esm.formatTimestamp)(v[0]);this.__oldConfig["time-value"]!=dataStr?(this.__config["time-value"]=dataStr,this.onChange("time-value")):this.value=this.__config["time-value"]},onOpen:()=>{this.__oldConfig["time-value"]=this.__config["time-value"]}})}setFlatpickrVal(val){this.__flatpickr&&!this.__flatpickr.isOpen&&this.__flatpickr.setDate(val)}createTemplate(){return`\n            <style>\n            /*时间弹窗*/\n            .timeline-datetime {\n                height: 18px !important;\n                border: 1px solid ${BD};\n                background-color: ${BG};\n                color: #fff;\n                border-radius: 2px;\n                width: 130px;\n                position: relative;\n                 -webkit-user-select: none; /* Safari */\n                user-select: none;\n            }\n\n             .time img {\n                cursor: pointer;\n                margin: 0px 8px;\n                z-index: 1;\n                height: 16px;\n                 -webkit-user-select: none; /* Safari */\n                user-select: none;\n            }\n            \n            .time img:hover {\n                background-color: #333333;\n            }\n            \n            .time {\n                height: 22px;\n                padding-top: 38px;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                color: #ffffff;\n                -webkit-user-select: none; /* Safari */\n                user-select: none;\n              \n            }\n            \n            .disabled {\n                pointer-events: none;\n            }\n            \n            video-progress-bar-forward-select {\n                position: relative;\n                top: -24.5px;\n                height: 0px;\n            }\n            </style>\n             <div class="time">\n                <div style="width: 60px"></div>\n                <video-progress-bar-forward-select id="speed" default-value="1" options=${JSON.stringify(speedOptions)}></video-progress-bar-forward-select>\n                <input id="datetime"  class="flatpickr timeline-datetime" data-enable-time="true" data-enable-seconds="true" >\n                <img id="bth-backward"  title="快退" src="${backward_namespaceObject}" />\n                <video-progress-bar-forward-select id="forward" default-value="60" options=${JSON.stringify(forwardOptions)}></video-progress-bar-forward-select>\n                <img id="bth-forward" title="快进" src="${forward_namespaceObject}" />\n            </div>\n        `}}customElements.get("video-progress-bar-active-time")||customElements.define("video-progress-bar-active-time",ActiveTime);var dist=__webpack_require__("./node_modules/.pnpm/@storybook+blocks@7.2.1_sfoxds7t5ydpegc3knd667wn6m/node_modules/@storybook/blocks/dist/index.mjs");var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@17.0.2/node_modules/react/jsx-runtime.js");const VideoProgressBar_stories={title:"Example/VideoProgressBar",component:VideoProgressBar,parameters:{layout:"centered",docs:{page:Story=>(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(dist.UG,{children:'## video-progress-bar\n\n`视频播放滚动条`\n\n## Usage\n\n```html\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>\n    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>\n    <title>video-progress-bar</title>\n    <style>\n        #root {\n            width: 100%;\n            height: 60px;\n        }\n    </style>\n</head>\n\n<body>\n<div id="root">\n    <div style="height: 400px;">\n       \n    </div>\n    <video-progress-bar id="bar"></video-progress-bar>\n</div>\n<script>\n    window.onload = function () {\n        setTimeout(()=> {\n            document.querySelector(\'#bar\').start();\n        }, 3000);\n        document.querySelector(\'#bar\').addEventListener(\'timeChange\', (e)=> {\n            console.log(222, e)\n        });\n    }\n<\/script>\n</body>\n</html>\n\n```\n\n\n\n'})})}},tags:["autodocs"],argTypes:{}},props={args:{},render:()=>(0,jsx_runtime.jsx)("video-progress-bar",{id:"video-progress-bar"})};props.parameters={...props.parameters,docs:{...props.parameters?.docs,source:{originalSource:'{\n  args: {},\n  render: () => {\n    return <video-progress-bar id="video-progress-bar"></video-progress-bar>;\n  }\n}',...props.parameters?.docs?.source}}};const __namedExportsOrder=["props"]}}]);